class SEOArticleWriter{constructor(){this.apiKey="",this.initializeElements(),this.loadSavedApiKey(),this.loadRecentArticles(),this.bindEvents()}initializeElements(){this.form=document.getElementById("article-form"),this.apiKeyInput=document.getElementById("api-key"),this.topicInput=document.getElementById("topic"),this.targetAudienceSelect=document.getElementById("target-audience"),this.keywordsInput=document.getElementById("keywords"),this.wordCountSelect=document.getElementById("word-count"),this.generateBtn=document.getElementById("generate-btn"),this.outputArea=document.getElementById("output-area"),this.loadingDiv=document.getElementById("loading"),this.copyBtn=document.getElementById("copy-btn"),this.errorMessage=document.getElementById("error-message"),this.successMessage=document.getElementById("success-message"),this.copyMessage=document.getElementById("copy-message"),this.recentArticlesContainer=document.getElementById("recent-articles"),this.clearRecentBtn=document.getElementById("clear-recent-btn"),this.resetBtn=document.getElementById("reset-btn")}loadSavedApiKey(){const e=localStorage.getItem("gemini-api-key");e&&(this.apiKeyInput.value=e,this.apiKey=e)}bindEvents(){this.form.addEventListener("submit",(e=>this.handleSubmit(e))),this.apiKeyInput.addEventListener("input",(e=>this.handleApiKeyChange(e))),this.copyBtn.addEventListener("click",(()=>this.copyToClipboard())),this.clearRecentBtn.addEventListener("click",(()=>this.clearRecentArticles())),this.resetBtn.addEventListener("click",(()=>this.resetForm()))}handleApiKeyChange(e){this.apiKey=e.target.value,this.apiKey&&(localStorage.setItem("gemini-api-key",this.apiKey),this.showSuccess("API Key ถูกบันทึกแล้ว"))}async handleSubmit(e){if(e.preventDefault(),this.validateForm()){this.showLoading(),this.hideMessages();try{const e=await this.generateArticle();this.displayArticle(e),this.saveRecentArticle(e),this.showSuccess("สร้างบทความสำเร็จ!")}catch(e){this.showError(`เกิดข้อผิดพลาด: ${e.message}`),console.error("Error:",e)}finally{this.hideLoading()}}}validateForm(){return this.apiKey.trim()?this.topicInput.value.trim()?!!this.targetAudienceSelect.value||(this.showError("กรุณาเลือกกลุ่มเป้าหมาย"),!1):(this.showError("กรุณาใส่หัวข้อบทความ"),!1):(this.showError("กรุณาใส่ API Key"),!1)}async generateArticle(){const e=this.topicInput.value.trim(),t=this.getTargetAudienceText(),s=this.keywordsInput.value.trim(),n=this.getWordCountText(),i=this.buildPrompt(e,t,s,n),r=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:i}]}],generationConfig:{temperature:.7,topK:40,topP:.95,maxOutputTokens:2048}})});if(!r.ok){const e=await r.json();throw new Error(e.error?.message||"ไม่สามารถเชื่อมต่อกับ Gemini API ได้")}const a=await r.json();if(!a.candidates||!a.candidates[0]||!a.candidates[0].content)throw new Error("ไม่ได้รับการตอบกลับจาก AI");return a.candidates[0].content.parts[0].text}buildPrompt(e,t,s,n){let i=`สร้างบทความ SEO ภาษาไทยที่มีคุณภาพสูงเกี่ยวกับหัวข้อ: "${e}"\n\nกลุ่มเป้าหมาย: ${t}\nความยาวบทความ: ${n}`;return s&&(i+=`\nคำสำคัญที่ต้องใส่: ${s}`),i+="\n\nกรุณาสร้างบทความที่มีโครงสร้างดังนี้:\n\n1. หัวข้อหลักที่น่าสนใจและเหมาะกับ SEO\n2. บทนำที่ดึงดูดความสนใจ\n3. เนื้อหาหลักแบ่งเป็นหัวข้อย่อยที่ชัดเจน\n4. ใช้ H2, H3 สำหรับหัวข้อย่อย\n5. เนื้อหาที่มีประโยชน์และตอบโจทย์ผู้อ่าน\n6. สรุปที่กระชับและมีการเรียกร้องให้ดำเนินการ (Call-to-Action)\n\nข้อกำหนดเพิ่มเติม:\n- ใช้ภาษาไทยที่เข้าใจง่าย\n- เหมาะสมกับกลุ่มเป้าหมาย\n- มีการกระจายคำสำคัญอย่างเป็นธรรมชาติ\n- เนื้อหาต้องมีคุณค่าและไม่ซ้ำใคร\n- ใช้รูปแบบ Markdown สำหรับการจัดรูปแบบ\n\nเริ่มสร้างบทความ:",i}getTargetAudienceText(){return{beginners:"ผู้เริ่มต้นที่ต้องการเรียนรู้พื้นฐาน",intermediate:"ผู้ที่มีความรู้ระดับกลาง",advanced:"ผู้เชี่ยวชาญที่ต้องการความรู้เชิงลึก","business-owners":"เจ้าของธุรกิจที่ต้องการเพิ่มยอดขาย",marketers:"นักการตลาดที่ต้องการเครื่องมือและกลยุทธ์",developers:"นักพัฒนาที่ต้องการความรู้ทางเทคนิค",students:"นักเรียนและนักศึกษาที่ต้องการความรู้เพื่อการศึกษา",general:"ผู้อ่านทั่วไปที่สนใจในหัวข้อนี้"}[this.targetAudienceSelect.value]||"ผู้อ่านทั่วไป"}getWordCountText(){return{short:"300-500 คำ",medium:"800-1200 คำ",long:"1500-2000 คำ"}[this.wordCountSelect.value]||"800-1200 คำ"}displayArticle(e){let t=this.convertListItems(e);t=t.replace(/^# (.*$)/gm,"<h1>$1</h1>").replace(/^## (.*$)/gm,"<h2>$1</h2>").replace(/^### (.*$)/gm,"<h3>$1</h3>").replace(/^#### (.*$)/gm,"<h4>$1</h4>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n\n/g,"</p><p>").replace(/^(?!<h[1-6]>|<\/p>|<p>|<ul>|<\/ul>|<li>)(.*$)/gm,"<p>$1</p>").replace(/<p><\/p>/g,"").replace(/<p>(<h[1-6]>.*<\/h[1-6]>)<\/p>/g,"$1").replace(/<p>(<ul>.*<\/ul>)<\/p>/gs,"$1").replace(/<p>(<li>.*<\/li>)<\/p>/g,"$1"),this.outputArea.innerHTML="",this.outputArea.innerHTML=t,this.addReadingTime(e),setTimeout((()=>{this.enhanceReadability()}),100),this.outputArea.scrollTop=0,this.copyBtn.classList.remove("hidden")}addReadingTime(e){const t=e.split(/\s+/).length,s=Math.ceil(t/200),n=document.createElement("div");n.className="text-sm text-gray-500 mb-6 pb-4 border-b border-gray-200 flex items-center justify-between",n.innerHTML=`\n      <div class="flex items-center">\n        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">\n          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>\n        </svg>\n        เวลาอ่าน: ${s} นาที\n      </div>\n      <div class="flex items-center">\n        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">\n          <path fill-rule="evenodd" d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z" clip-rule="evenodd"/>\n        </svg>\n        จำนวนคำ: ${t} คำ\n      </div>\n    `,this.outputArea.insertBefore(n,this.outputArea.firstChild)}convertListItems(e){const t=e.split("\n");let s=[],n=!1;for(let e=0;e<t.length;e++){const i=t[e],r=i.trim();if(/^[\*\-]\s+(.+)/.test(r)){const e=r.replace(/^[\*\-]\s+/,"");n||(s.push("<ul>"),n=!0),s.push(`  <li>${e}</li>`)}else n&&(s.push("</ul>"),n=!1),r.length>0?s.push(i):n||s.push("")}return n&&s.push("</ul>"),s.join("\n")}enhanceReadability(){const e=this.outputArea.querySelectorAll("h2, h3");e.length>2&&this.addTableOfContents(e),this.addSmoothScrolling()}addTableOfContents(e){const t=document.createElement("div");t.className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",t.innerHTML='<h3 class="text-lg font-semibold text-blue-800 mb-3 flex items-center"><svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/></svg>สารบัญ</h3>';const s=document.createElement("ul");s.className="space-y-2",e.forEach(((e,t)=>{const n=`heading-${t}`;e.id=n;const i=document.createElement("li");i.className="H2"===e.tagName?"ml-0":"ml-4",i.innerHTML=`<a href="#${n}" class="text-blue-600 hover:text-blue-800 hover:underline transition-colors duration-200">${e.textContent}</a>`,s.appendChild(i)})),t.appendChild(s);const n=this.outputArea.querySelector(".text-sm.text-gray-500");n&&n.parentNode.insertBefore(t,n.nextSibling)}addSmoothScrolling(){this.outputArea.querySelectorAll('a[href^="#"]').forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();const s=document.querySelector(e.getAttribute("href"));s&&s.scrollIntoView({behavior:"smooth",block:"start"})}))}))}async copyToClipboard(){try{const e=this.outputArea.innerText;await navigator.clipboard.writeText(e),this.showSuccess("คัดลอกบทความเรียบร้อยแล้ว!"),this.copySuccess("คัดลอกบทความเรียบร้อยแล้ว!")}catch(e){this.showError("ไม่สามารถคัดลอกได้")}}showLoading(){this.loadingDiv.classList.remove("hidden"),this.outputArea.classList.add("hidden"),this.generateBtn.disabled=!0,this.copyBtn.classList.add("hidden")}hideLoading(){this.loadingDiv.classList.add("hidden"),this.outputArea.classList.remove("hidden"),this.generateBtn.disabled=!1}showError(e){document.getElementById("error-text").textContent=e,this.errorMessage.classList.remove("hidden"),this.successMessage.classList.add("hidden"),setTimeout((()=>this.hideMessages()),5e3)}showSuccess(e){document.getElementById("success-text").textContent=e,this.successMessage.classList.remove("hidden"),this.errorMessage.classList.add("hidden"),setTimeout((()=>this.hideMessages()),3e3)}copySuccess(e){document.getElementById("copy-message").textContent=e,this.copyMessage.classList.remove("hidden"),setTimeout((()=>this.copyMessage.classList.add("hidden")),3e3)}hideMessages(){this.errorMessage.classList.add("hidden"),this.successMessage.classList.add("hidden")}saveRecentArticle(e){const t={id:Date.now(),title:this.topicInput.value.trim(),content:e,targetAudience:this.targetAudienceSelect.value,keywords:this.keywordsInput.value.trim(),wordCount:this.wordCountSelect.value,createdAt:(new Date).toISOString()};let s=this.getRecentArticles();s.unshift(t),s.length>10&&(s=s.slice(0,10)),localStorage.setItem("recent-articles",JSON.stringify(s)),this.loadRecentArticles()}getRecentArticles(){const e=localStorage.getItem("recent-articles");return e?JSON.parse(e):[]}loadRecentArticles(){const e=this.getRecentArticles();if(0===e.length)return this.recentArticlesContainer.innerHTML='<div class="text-center text-gray-500 py-8 italic">ยังไม่มีบทความที่สร้างไว้</div>',void this.clearRecentBtn.classList.add("hidden");this.clearRecentBtn.classList.remove("hidden");const t=e.map((e=>{const t=new Date(e.createdAt).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),s=this.getAudienceDisplayText(e.targetAudience);return`\n        <div class="bg-gradient-light-blue border border-sky-200 rounded-lg p-4 hover:shadow-lg hover:-translate-y-1 transition-all duration-300 hover:border-blue-500 relative group">\n          <div class="cursor-pointer" data-article-id="${e.id}">\n            <div class="font-semibold text-blue-800 mb-2 text-sm pr-8">${e.title}</div>\n            <div class="flex justify-between items-center text-xs text-gray-600">\n              <span class="opacity-80">${t}</span>\n              <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">${s}</span>\n            </div>\n          </div>\n          <button class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-full p-1" \n                  data-delete-id="${e.id}" \n                  title="ลบบทความนี้">\n            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">\n              <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>\n            </svg>\n          </button>\n        </div>\n      `})).join("");this.recentArticlesContainer.innerHTML=t,this.recentArticlesContainer.querySelectorAll("[data-article-id]").forEach((e=>{e.addEventListener("click",(e=>{const t=parseInt(e.currentTarget.dataset.articleId);this.loadRecentArticle(t)}))})),this.recentArticlesContainer.querySelectorAll("[data-delete-id]").forEach((e=>{e.addEventListener("click",(e=>{e.stopPropagation();const t=parseInt(e.currentTarget.dataset.deleteId);this.deleteRecentArticle(t)}))}))}getAudienceDisplayText(e){return{beginners:"ผู้เริ่มต้น",intermediate:"ระดับกลาง",advanced:"ระดับสูง","business-owners":"เจ้าของธุรกิจ",marketers:"นักการตลาด",developers:"นักพัฒนา",students:"นักเรียน/นักศึกษา",general:"ทั่วไป"}[e]||"ทั่วไป"}loadRecentArticle(e){const t=this.getRecentArticles().find((t=>t.id===e));t?(this.topicInput.value=t.title,this.targetAudienceSelect.value=t.targetAudience,this.keywordsInput.value=t.keywords||"",this.wordCountSelect.value=t.wordCount,this.displayArticle(t.content),this.showSuccess("โหลดบทความเรียบร้อยแล้ว!")):this.showError("ไม่พบบทความที่เลือก")}clearRecentArticles(){confirm("คุณต้องการลบประวัติบทความทั้งหมดหรือไม่?")&&(localStorage.removeItem("recent-articles"),this.loadRecentArticles(),this.showSuccess("ลบประวัติบทความทั้งหมดแล้ว"))}resetForm(){this.topicInput.value="",this.targetAudienceSelect.value="",this.keywordsInput.value="",this.wordCountSelect.value="medium",this.outputArea.innerHTML='\n      <div class="text-center text-gray-500 py-12">\n        <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20">\n          <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"/>\n        </svg>\n        <p>บทความ SEO ที่สร้างจะแสดงที่นี่...</p>\n        <p class="text-sm mt-2">คุณสามารถใส่ API Key ของ Google Gemini และเริ่มสร้างบทความได้เลย!</p>\n      </div>\n    ',this.copyBtn.classList.add("hidden"),this.hideMessages(),this.topicInput.focus(),this.showSuccess("รีเซ็ตฟอร์มเรียบร้อยแล้ว")}deleteRecentArticle(e){if(confirm("คุณต้องการลบบทความนี้หรือไม่?")){let t=this.getRecentArticles();t=t.filter((t=>t.id!==e)),localStorage.setItem("recent-articles",JSON.stringify(t)),this.loadRecentArticles(),this.showSuccess("ลบบทความเรียบร้อยแล้ว")}}}document.addEventListener("DOMContentLoaded",(()=>{const e=new SEOArticleWriter;window.testListConversion=function(){const t="# หัวข้อหลัก\n\nข้อความปกติ\n\n* รายการที่ 1\n* รายการที่ 2\n* รายการที่ 3\n\nข้อความอื่น\n\n- รายการแบบ dash\n- อีกรายการหนึ่ง\n\nสิ้นสุด";console.log("Original:",t),console.log("Converted:",e.convertListItems(t))}}));